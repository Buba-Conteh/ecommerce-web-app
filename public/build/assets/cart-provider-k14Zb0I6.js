import{r as c,j as p}from"./app-CK4fKavl.js";const y=c.createContext(null);function m(r,n){switch(n.type){case"ADD_ITEM":{if(r.items.find(e=>e.id===n.payload.id)){const e=r.items.map(o=>o.id===n.payload.id?{...o,quantity:o.quantity+(n.payload.quantity||1)}:o);return{...r,items:e,total:e.reduce((o,s)=>o+s.price*s.quantity,0),itemCount:e.reduce((o,s)=>o+s.quantity,0)}}const t=[...r.items,{...n.payload,quantity:n.payload.quantity||1}];return{...r,items:t,total:t.reduce((e,o)=>e+o.price*o.quantity,0),itemCount:t.reduce((e,o)=>e+o.quantity,0)}}case"REMOVE_ITEM":{const a=r.items.filter(t=>t.id!==n.payload);return{...r,items:a,total:a.reduce((t,e)=>t+e.price*e.quantity,0),itemCount:a.reduce((t,e)=>t+e.quantity,0)}}case"UPDATE_QUANTITY":{const a=r.items.map(t=>t.id===n.payload.id?{...t,quantity:Math.max(0,n.payload.quantity)}:t).filter(t=>t.quantity>0);return{...r,items:a,total:a.reduce((t,e)=>t+e.price*e.quantity,0),itemCount:a.reduce((t,e)=>t+e.quantity,0)}}case"CLEAR_CART":return{items:[],total:0,itemCount:0};default:return r}}function f({children:r}){const[n,a]=c.useReducer(m,{items:[],total:0,itemCount:0});c.useEffect(()=>{try{const i=typeof window<"u"?window.localStorage.getItem("cart-state"):null;if(i){const u=JSON.parse(i);if(u&&Array.isArray(u.items)){u.total=u.items.reduce((d,l)=>d+l.price*l.quantity,0),u.itemCount=u.items.reduce((d,l)=>d+l.quantity,0),a({type:"CLEAR_CART"});for(const d of u.items)a({type:"ADD_ITEM",payload:{...d}})}}}catch(i){console.warn("Failed to hydrate cart from localStorage",i)}},[]),c.useEffect(()=>{try{typeof window<"u"&&window.localStorage.setItem("cart-state",JSON.stringify(n))}catch(i){console.warn("Failed to persist cart to localStorage",i)}},[n]);const t=i=>{console.log("[v0] CartProvider addToCart called with:",i),a({type:"ADD_ITEM",payload:i}),console.log("[v0] Dispatched ADD_ITEM action")},e=i=>{a({type:"REMOVE_ITEM",payload:i})},o=(i,u)=>{a({type:"UPDATE_QUANTITY",payload:{id:i,quantity:u}})},s=()=>{a({type:"CLEAR_CART"})};return p.jsx(y.Provider,{value:{state:n,dispatch:a,addToCart:t,removeFromCart:e,updateQuantity:o,clearCart:s},children:r})}function E(){const r=c.useContext(y);if(!r)throw new Error("useCart must be used within a CartProvider");return r}export{f as C,E as u};
